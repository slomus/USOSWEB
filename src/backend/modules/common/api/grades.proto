syntax = "proto3";
package grades;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/slomus/USOSWEB/src/backend/modules/common/gen/grades";

message Grade {
  int32 grade_id = 10;
  int32 album_nr = 11;
  int32 class_id = 12;
  int32 subject_id = 13;
  string value = 14;
  int32 weight = 15;
  int32 attempt = 16;
  int32 added_by_teaching_staff_id = 17;
  string comment = 18;
  string created_at = 19;
  optional string subject_name = 20;
  optional string added_by_name = 21;
  optional string student_name = 22; 
  optional string class_type = 23; 
}

message ListGradesRequest { 
  optional int32 album_nr = 10; 
  optional bool all_students = 11;
}

message ListGradesResponse {
  repeated Grade grades = 10;
  string message = 11;
}

message AddGradeRequest {
  int32 album_nr = 10;
  int32 class_id = 11;
  int32 subject_id = 12;
  string value = 13;
  optional int32 weight = 14;
  optional int32 attempt = 15;
  optional string comment = 16;
  optional int32 as_teaching_staff_id = 17;
}

message AddGradeResponse {
  Grade grade = 10;
  string message = 11;
}

message GetRecentGradesRequest {
  optional int32 limit = 10; 
}

message GetRecentGradesResponse {
  repeated Grade grades = 10;
  string message = 11;
}

message UpdateGradeRequest {
  int32 grade_id = 10;
  optional string value = 11;
  optional int32 weight = 12;
  optional string comment = 13;
}

message UpdateGradeResponse {
  Grade grade = 10;
  string message = 11;
}

message DeleteGradeRequest {
  int32 grade_id = 10;
}

message DeleteGradeResponse {
  bool success = 10;
  string message = 11;
}


message TeacherClass {
  int32 class_id = 10;
  int32 subject_id = 11;
  string subject_name = 12;
  string subject_alias = 13;
  string class_type = 14;
  int32 group_nr = 15;
  int32 current_capacity = 16;
  int32 capacity = 17;
  string semester = 18;
  string academic_year = 19;
  int32 classroom = 20;
  string building_name = 21;
}

message GetTeacherClassesRequest {
}

message GetTeacherClassesResponse {
  repeated TeacherClass classes = 10;
  string message = 11;
}

message StudentOption {
  int32 album_nr = 10;
  string name = 11;
  string course_name = 12;
}

message TeacherOption {
  int32 teaching_staff_id = 10;
  string name = 11;
  repeated int32 subject_ids = 12;
}

message SubjectOption {
  int32 subject_id = 10;
  string name = 11;
  string alias = 12;
}

message ClassOption {
  int32 class_id = 10;
  int32 subject_id = 11;
  string subject_name = 12;
  string class_type = 13;
  int32 group_nr = 14;
  repeated int32 teacher_ids = 15;
  repeated int32 student_album_nrs = 16;
}

message GetAdminGradeOptionsRequest {
}

message GetAdminGradeOptionsResponse {
  repeated StudentOption students = 10;
  repeated TeacherOption teachers = 11;
  repeated SubjectOption subjects = 12;
  repeated ClassOption classes = 13;
  string message = 14;
}


service GradesService {
  rpc ListGrades(ListGradesRequest) returns (ListGradesResponse) {
    option (google.api.http) = {
      get : "/api/grades"
    };
  }

  rpc AddGrade(AddGradeRequest) returns (AddGradeResponse) {
    option (google.api.http) = {
      post : "/api/grades"
      body : "*"
    };
  }

  rpc GetRecentGrades(GetRecentGradesRequest) returns (GetRecentGradesResponse) {
    option (google.api.http) = {
      get : "/api/student/grades/recent"
    };
  }

  rpc UpdateGrade(UpdateGradeRequest) returns (UpdateGradeResponse) {
    option (google.api.http) = {
      put : "/api/grades/{grade_id}"
      body : "*"
    };
  }

  rpc DeleteGrade(DeleteGradeRequest) returns (DeleteGradeResponse) {
    option (google.api.http) = {
      delete : "/api/grades/{grade_id}"
    };
  }

  rpc GetTeacherClasses(GetTeacherClassesRequest) returns (GetTeacherClassesResponse) {
    option (google.api.http) = {
      get : "/api/teacher/classes"
    };
  }

  rpc GetAdminGradeOptions(GetAdminGradeOptionsRequest) returns (GetAdminGradeOptionsResponse) {
    option (google.api.http) = {
      get : "/api/admin/grade-options"
    };
  }
}
